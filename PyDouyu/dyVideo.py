
#api
#https://www.douyu.com/lapi/live/getH5Play/4874542


#import requests
import os
import urllib.request
import re
import execjs
from html.parser import HTMLParser
import sys
from PyChakra.ChakraCore import *
import json
import subprocess






test_ub98484234  = """
var vdwdae325w_64we = "220120190304";    
var p2dcb4269efcfd3d2bb54=[0x9edf5201,0x7c09cb7e,0xfc4d7778,0x798a07dc,0xbfb06ff0,0xa86f49b3,0x2733c448,0x665b1cb7,0x1169218c,0x679e0e15,0x1237a621,0xc0ea5027,0x6398e93c,0xdb181805,0x9d72715e,0x2c79168c,0xfb6f8d10,0x492c825b,0x41ca98f8,0xbaefd86c,0xee85decf,0x47f386a7,0xae7c32f9,0x669427da,0x1389a836,0x2fbc4785,0x9c44a437,0x7999f696,0x764a2950,0x47cd06d7,0xf3bf58c5,0xff3545f3,0x6b55d98b,0xdc84b2ca,0x93c2d3c4,0x1dd5a25f,0xff61225d,0xd3298ddf,0x8244f5e0,0x799bad5a,0xb5b94c6f,0xe8622ae,0xe0f44e07,0x7ba15c71,0x8ad7145d,0x90ca05b,0x68ed7268,0xd20263f1,0x8d0a6f42,0xce582342,0x1f28b3c7,0xabf12951,0xfa5f2b4d,0xee198073,0x6be9c1ec,0x36bd7a76,0x7d6f6c1b,0x25c06ec7,0x504986b2,0xb6f3b415,0x20628b53,0x669a9a28,0xac98c4c2,0xd7b8abba,0xae76c87,0x1a70d52b,0x816779f0,0x3e1f76d9,0xc90538af,0x4597284f,0xfb6738e0,0xd5eadf23,0x5dc3c896,0x8249ce9f,0x27e95ccb,0xb28562ab,0x1cc90403,0x87e0c548,0xd92c143b,0x6247d992,0x520adf69,0xbbd735e5,0xaaca66d4,0xd2de9949,0xc9e00457,0x3a509955,0xbb888ee4,0xf98712f4,0x59a666f3,0xba7584f4,0x7e0923f5,0x2ac922d0,0xfb28e569,0x5e4764fc,0xb0ad7cd2,0x30817386,0x100e8488,0x69ccb556,0x5a2ba7fe,0x23e2594c,0xa9dbf0d,0xb83093cf,0x468b0975,0x471e181d,0x78afc04d,0x7f9d74fb,0xde907664,0x555c532b,0x4ac87d1b,0x1b8bfcb6,0x931cc545,0x72a1f0b0,0xa5c7e833,0x1eacfef2,0x928fe546,0x7ce0c410,0x85014c4,0x8bd3d2c1,0x6e77a382,0xc92ae7f1,0x1395a069,0xf2d50a41,0xf2c09603,0xcfa78d8d,0xec028c92,0x58fdfae2,0x28e482e1,0xb393097b,0xe65c9ecc,0x8c60c752,0x3e74fc3f,0xaffc1b15,0x1f41adfd,0x3c9d3995,0x7da07db1,0xc21ebdb4,0x423d5171,0xbf40217f,0x6e029ea1,0xe1862d0b,0x922886ea,0x6e402dc4,0xa286478c,0xaef455ee,0x38bdfce3,0x6a0bb556,0x76656fa7,0x1deef67c,0x780b9173,0x12134349,0x46811212,0xa374ab1c,0xbe661a2c,0x72e90ddf,0xd42a59a0,0xa0709b27,0x6e4f1355,0xe808f513,0xc9c22678,0xc64eb33a,0x86b6318,0x1716f22d,0xf1fdfb45,0x5990bde7,0x48ad16ed,0xa3994b3f,0x3c3d4d3c,0x97d0c22b,0x5624988e,0x122ca9d6,0xb9df3dd,0xcbdbe347,0x37954261,0x5a81c4f6,0xd59cabb0,0xdf095a55,0x7194db6e,0xb49e3b40,0x4ca7813b,0x102845e5,0xe7832526,0x515c845f,0x49cc80fe,0xa4da9616,0xcf318adb,0x758b151c,0xf4199f2e,0x5313e8ab,0x913da57,0xfcf25bc6,0x37d31bb1,0x9268edfc,0x6e74bd36,0x405558c6,0x8d991b14,0xa4d067ac,0xf42eeef6,0x5a2dedf1,0x3850a063,0x73e10f94,0xaad6526d,0x485efcf3,0x6cd5a0e0,0x56a41c04,0x430cb563,0x7434ad6e,0x3fd9146d,0x42e0bdbf,0x1481da92,0x342da49d,0x2bb77145,0x4464d064,0x8754e85a,0xdc4a5cd8,0x218b084,0x37480717,0x10a5b496,0x44cb5890,0x48c6afeb,0x8667085c,0xeaf0148d,0x4617fd58,0xd2050618,0xd1abe211,0xb81d5703,0x94acff0e,0xd433b510,0x75fc344a,0x9f720a42,0x82c24147,0xb18696b5,0x83f6f48a,0x1f11f183,0x22016bff,0x98a355a7,0x2b3d463d,0x562724c0,0xa2ed74e2,0x408acaf5,0x48f3fcb6,0xbc2eeda4,0x3f196416,0x1c210e02,0x7b07950f,0xd9132fe5,0x4a893028,0x1d89d494,0xf32c2fea,0x9d180244,0x4da8d5bb,0xab1f9b37,0xcdf58742,0x83d7f6dc,0x9af38171,0x6c22b79a,0xf283a95e,0x85cc3f95,0xc2fd8e0a,0x5d20cc93,0x1c80de76,0x230e86a4,0x2857ce50,0xbad9aaa2,0xfb331599,0xb446efef,0xca086489,0x90c0f32f,0xd8c19482,0xaeb1216f,0xe14a3183,0xceb79154,0x3cba3bb5,0xc05937e4,0x2005df6,0xbf10d16f,0x2bc4d307,0x36ed9a86,0xa7fab9da,0x4e84e31a,0xa0e22176,0x5aab4a4e,0xbb17b7a1,0x8864f930,0x2a45a680,0xbc0adc74,0x452c3c6c,0x4a1274c4,0x19808d73,0xc9ae10a1,0xeaf25b9a,0xda933a62,0x570743e1,0x9ddc14e7,0x46a8ab88,0xb7888154,0x713ca385,0x5a771164,0x68bd621f,0x5ac9d9ef,0x30b82cf9,0xcd092b5,0xb23ad773,0x78a45d37,0x96d758cb,0x70b40824,0xc7529734,0xe4820361,0x5329466a,0x61bd71b5,0xcbcbbb2d,0x3782091b,0x4ddc1629,0xa0c93d24,0x7c66b89d,0xb99a4fb1,0x648aff6e,0x84569e06,0x995d8309,0x41068274,0x21e2b8ac,0x35d809bd,0xba398284,0x216043f9,0xf021e57c,0x79c06edc,0xdbbd59e,0xdbbe6c5e,0xb4b74485,0xd67c57aa,0x9e5239a4,0x638e07a5,0xb587e968,0xe603b25d,0xbc81c043,0x3c60e0ea,0x27e7bb44,0xb1435f4c,0x6a68bd45,0xf4d863d9,0x6839e6be,0x91c41738,0x67d7bc42,0x5c4e939,0xfaeaf616,0xe5a1625b,0x82da79dc,0x18da0c,0xb09b2b53,0x62a22dc,0x46298435,0x594016a2,0xde90237a,0x839b1ce3,0x39936e76,0xf8ce209,0x9b0a369d,0x556ff0cb,0x9c731c52,0xacf811f1,0x1a911910,0x5104fb04,0x5cfbd7b2,0x915cc890,0x73196505,0xb3ac9db6,0xdc5fa086,0x8dced725,0x17bec9df];   
function ub98484234(p2dcb4269efcfd3d2bb540,p2dcb4269efcfd3d2bb541,p2dcb4269efcfd3d2bb542)
{
var rk=[13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,
21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,
10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,
41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,
10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,
21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21,41,20,33,37,10,13,28,37,21];
var k2=[0x7fab3334,0x256b8cec];var lk=[0x7fab3334,0x256b8cec];
var v = p2dcb4269efcfd3d2bb54.slice(0);
var k=[0x3bbe6784,0x6cd672ae,0x96496df1,0xbfe901eb];
for(var O=0;O<368;O++){
v[O]^=0x75b1ba2d;}v[1]-=lk[1];v[0]-=lk[0];v[3]=(v[3]<<(lk[1]%16))|(v[3]>>>(32-(lk[1]%16)));
v[2]^=lk[0];v[5]+=lk[1];v[4]+=lk[0];v[7]+=lk[1];v[6]=(v[6]>>>(lk[0]%16))|(v[6]<<(32-(lk[0]%16)));
v[9]+=lk[1];v[8]=(v[8]>>>(lk[0]%16))|(v[8]<<(32-(lk[0]%16)));v[11]-=lk[1];v[10]=(v[10]<<(lk[0]%16))|(v[10]>>>(32-(lk[0]%16)));v[13]-=lk[1];v[12]^=lk[0];v[15]^=lk[1];v[14]=(v[14]>>>(lk[0]%16))|(v[14]<<(32-(lk[0]%16)));v[17]-=lk[1];v[16]-=lk[0];v[19]-=lk[1];v[18]-=lk[0];v[21]=(v[21]<<(lk[1]%16))|(v[21]>>>(32-(lk[1]%16)));v[20]^=lk[0];v[23]+=lk[1];v[22]+=lk[0];v[25]+=lk[1];v[24]=(v[24]>>>(lk[0]%16))|(v[24]<<(32-(lk[0]%16)));v[27]+=lk[1];v[26]=(v[26]>>>(lk[0]%16))|(v[26]<<(32-(lk[0]%16)));v[29]-=lk[1];v[28]=(v[28]<<(lk[0]%16))|(v[28]>>>(32-(lk[0]%16)));v[31]-=lk[1];v[30]^=lk[0];v[33]^=lk[1];v[32]=(v[32]>>>(lk[0]%16))|(v[32]<<(32-(lk[0]%16)));v[35]-=lk[1];v[34]-=lk[0];v[37]-=lk[1];v[36]-=lk[0];v[39]=(v[39]<<(lk[1]%16))|(v[39]>>>(32-(lk[1]%16)));v[38]^=lk[0];v[41]+=lk[1];v[40]+=lk[0];v[43]+=lk[1];v[42]=(v[42]>>>(lk[0]%16))|(v[42]<<(32-(lk[0]%16)));v[45]+=lk[1];v[44]=(v[44]>>>(lk[0]%16))|(v[44]<<(32-(lk[0]%16)));v[47]-=lk[1];v[46]=(v[46]<<(lk[0]%16))|(v[46]>>>(32-(lk[0]%16)));v[49]-=lk[1];v[48]^=lk[0];v[51]^=lk[1];v[50]=(v[50]>>>(lk[0]%16))|(v[50]<<(32-(lk[0]%16)));v[53]-=lk[1];v[52]-=lk[0];v[55]-=lk[1];v[54]-=lk[0];v[57]=(v[57]<<(lk[1]%16))|(v[57]>>>(32-(lk[1]%16)));v[56]^=lk[0];v[59]+=lk[1];v[58]+=lk[0];v[61]+=lk[1];v[60]=(v[60]>>>(lk[0]%16))|(v[60]<<(32-(lk[0]%16)));v[63]+=lk[1];v[62]=(v[62]>>>(lk[0]%16))|(v[62]<<(32-(lk[0]%16)));v[65]-=lk[1];v[64]=(v[64]<<(lk[0]%16))|(v[64]>>>(32-(lk[0]%16)));v[67]-=lk[1];v[66]^=lk[0];v[69]^=lk[1];v[68]=(v[68]>>>(lk[0]%16))|(v[68]<<(32-(lk[0]%16)));v[71]-=lk[1];v[70]-=lk[0];v[73]-=lk[1];v[72]-=lk[0];v[75]=(v[75]<<(lk[1]%16))|(v[75]>>>(32-(lk[1]%16)));v[74]^=lk[0];v[77]+=lk[1];v[76]+=lk[0];v[79]+=lk[1];v[78]=(v[78]>>>(lk[0]%16))|(v[78]<<(32-(lk[0]%16)));v[81]+=lk[1];v[80]=(v[80]>>>(lk[0]%16))|(v[80]<<(32-(lk[0]%16)));v[83]-=lk[1];v[82]=(v[82]<<(lk[0]%16))|(v[82]>>>(32-(lk[0]%16)));v[85]-=lk[1];v[84]^=lk[0];v[87]^=lk[1];v[86]=(v[86]>>>(lk[0]%16))|(v[86]<<(32-(lk[0]%16)));v[89]-=lk[1];v[88]-=lk[0];v[91]-=lk[1];v[90]-=lk[0];v[93]=(v[93]<<(lk[1]%16))|(v[93]>>>(32-(lk[1]%16)));v[92]^=lk[0];v[95]+=lk[1];v[94]+=lk[0];v[97]+=lk[1];v[96]=(v[96]>>>(lk[0]%16))|(v[96]<<(32-(lk[0]%16)));v[99]+=lk[1];v[98]=(v[98]>>>(lk[0]%16))|(v[98]<<(32-(lk[0]%16)));v[101]-=lk[1];v[100]=(v[100]<<(lk[0]%16))|(v[100]>>>(32-(lk[0]%16)));v[103]-=lk[1];v[102]^=lk[0];v[105]^=lk[1];v[104]=(v[104]>>>(lk[0]%16))|(v[104]<<(32-(lk[0]%16)));v[107]-=lk[1];v[106]-=lk[0];v[109]-=lk[1];v[108]-=lk[0];v[111]=(v[111]<<(lk[1]%16))|(v[111]>>>(32-(lk[1]%16)));v[110]^=lk[0];v[113]+=lk[1];v[112]+=lk[0];v[115]+=lk[1];v[114]=(v[114]>>>(lk[0]%16))|(v[114]<<(32-(lk[0]%16)));v[117]+=lk[1];v[116]=(v[116]>>>(lk[0]%16))|(v[116]<<(32-(lk[0]%16)));v[119]-=lk[1];v[118]=(v[118]<<(lk[0]%16))|(v[118]>>>(32-(lk[0]%16)));v[121]-=lk[1];v[120]^=lk[0];v[123]^=lk[1];v[122]=(v[122]>>>(lk[0]%16))|(v[122]<<(32-(lk[0]%16)));v[125]-=lk[1];v[124]-=lk[0];v[127]-=lk[1];v[126]-=lk[0];v[129]=(v[129]<<(lk[1]%16))|(v[129]>>>(32-(lk[1]%16)));v[128]^=lk[0];v[131]+=lk[1];v[130]+=lk[0];v[133]+=lk[1];v[132]=(v[132]>>>(lk[0]%16))|(v[132]<<(32-(lk[0]%16)));v[135]+=lk[1];v[134]=(v[134]>>>(lk[0]%16))|(v[134]<<(32-(lk[0]%16)));v[137]-=lk[1];v[136]=(v[136]<<(lk[0]%16))|(v[136]>>>(32-(lk[0]%16)));v[139]-=lk[1];v[138]^=lk[0];v[141]^=lk[1];v[140]=(v[140]>>>(lk[0]%16))|(v[140]<<(32-(lk[0]%16)));v[143]-=lk[1];v[142]-=lk[0];v[145]-=lk[1];v[144]-=lk[0];v[147]=(v[147]<<(lk[1]%16))|(v[147]>>>(32-(lk[1]%16)));v[146]^=lk[0];v[149]+=lk[1];v[148]+=lk[0];v[151]+=lk[1];v[150]=(v[150]>>>(lk[0]%16))|(v[150]<<(32-(lk[0]%16)));v[153]+=lk[1];v[152]=(v[152]>>>(lk[0]%16))|(v[152]<<(32-(lk[0]%16)));v[155]-=lk[1];v[154]=(v[154]<<(lk[0]%16))|(v[154]>>>(32-(lk[0]%16)));v[157]-=lk[1];v[156]^=lk[0];v[159]^=lk[1];v[158]=(v[158]>>>(lk[0]%16))|(v[158]<<(32-(lk[0]%16)));v[161]-=lk[1];v[160]-=lk[0];v[163]-=lk[1];v[162]-=lk[0];v[165]=(v[165]<<(lk[1]%16))|(v[165]>>>(32-(lk[1]%16)));v[164]^=lk[0];v[167]+=lk[1];v[166]+=lk[0];v[169]+=lk[1];v[168]=(v[168]>>>(lk[0]%16))|(v[168]<<(32-(lk[0]%16)));v[171]+=lk[1];v[170]=(v[170]>>>(lk[0]%16))|(v[170]<<(32-(lk[0]%16)));v[173]-=lk[1];v[172]=(v[172]<<(lk[0]%16))|(v[172]>>>(32-(lk[0]%16)));v[175]-=lk[1];v[174]^=lk[0];v[177]^=lk[1];v[176]=(v[176]>>>(lk[0]%16))|(v[176]<<(32-(lk[0]%16)));v[179]-=lk[1];v[178]-=lk[0];v[181]-=lk[1];v[180]-=lk[0];v[183]=(v[183]<<(lk[1]%16))|(v[183]>>>(32-(lk[1]%16)));v[182]^=lk[0];v[185]+=lk[1];v[184]+=lk[0];v[187]+=lk[1];v[186]=(v[186]>>>(lk[0]%16))|(v[186]<<(32-(lk[0]%16)));v[189]+=lk[1];v[188]=(v[188]>>>(lk[0]%16))|(v[188]<<(32-(lk[0]%16)));v[191]-=lk[1];v[190]=(v[190]<<(lk[0]%16))|(v[190]>>>(32-(lk[0]%16)));v[193]-=lk[1];v[192]^=lk[0];v[195]^=lk[1];v[194]=(v[194]>>>(lk[0]%16))|(v[194]<<(32-(lk[0]%16)));v[197]-=lk[1];v[196]-=lk[0];v[199]-=lk[1];v[198]-=lk[0];v[201]=(v[201]<<(lk[1]%16))|(v[201]>>>(32-(lk[1]%16)));v[200]^=lk[0];v[203]+=lk[1];v[202]+=lk[0];v[205]+=lk[1];v[204]=(v[204]>>>(lk[0]%16))|(v[204]<<(32-(lk[0]%16)));v[207]+=lk[1];v[206]=(v[206]>>>(lk[0]%16))|(v[206]<<(32-(lk[0]%16)));v[209]-=lk[1];v[208]=(v[208]<<(lk[0]%16))|(v[208]>>>(32-(lk[0]%16)));v[211]-=lk[1];v[210]^=lk[0];v[213]^=lk[1];v[212]=(v[212]>>>(lk[0]%16))|(v[212]<<(32-(lk[0]%16)));v[215]-=lk[1];v[214]-=lk[0];v[217]-=lk[1];v[216]-=lk[0];v[219]=(v[219]<<(lk[1]%16))|(v[219]>>>(32-(lk[1]%16)));v[218]^=lk[0];v[221]+=lk[1];v[220]+=lk[0];v[223]+=lk[1];v[222]=(v[222]>>>(lk[0]%16))|(v[222]<<(32-(lk[0]%16)));v[225]+=lk[1];v[224]=(v[224]>>>(lk[0]%16))|(v[224]<<(32-(lk[0]%16)));v[227]-=lk[1];v[226]=(v[226]<<(lk[0]%16))|(v[226]>>>(32-(lk[0]%16)));v[229]-=lk[1];v[228]^=lk[0];v[231]^=lk[1];v[230]=(v[230]>>>(lk[0]%16))|(v[230]<<(32-(lk[0]%16)));v[233]-=lk[1];v[232]-=lk[0];v[235]-=lk[1];v[234]-=lk[0];v[237]=(v[237]<<(lk[1]%16))|(v[237]>>>(32-(lk[1]%16)));v[236]^=lk[0];v[239]+=lk[1];v[238]+=lk[0];v[241]+=lk[1];v[240]=(v[240]>>>(lk[0]%16))|(v[240]<<(32-(lk[0]%16)));v[243]+=lk[1];v[242]=(v[242]>>>(lk[0]%16))|(v[242]<<(32-(lk[0]%16)));v[245]-=lk[1];v[244]=(v[244]<<(lk[0]%16))|(v[244]>>>(32-(lk[0]%16)));v[247]-=lk[1];v[246]^=lk[0];v[249]^=lk[1];v[248]=(v[248]>>>(lk[0]%16))|(v[248]<<(32-(lk[0]%16)));v[251]-=lk[1];v[250]-=lk[0];v[253]-=lk[1];v[252]-=lk[0];v[255]=(v[255]<<(lk[1]%16))|(v[255]>>>(32-(lk[1]%16)));v[254]^=lk[0];v[257]+=lk[1];v[256]+=lk[0];v[259]+=lk[1];v[258]=(v[258]>>>(lk[0]%16))|(v[258]<<(32-(lk[0]%16)));v[261]+=lk[1];v[260]=(v[260]>>>(lk[0]%16))|(v[260]<<(32-(lk[0]%16)));v[263]-=lk[1];v[262]=(v[262]<<(lk[0]%16))|(v[262]>>>(32-(lk[0]%16)));v[265]-=lk[1];v[264]^=lk[0];v[267]^=lk[1];v[266]=(v[266]>>>(lk[0]%16))|(v[266]<<(32-(lk[0]%16)));v[269]-=lk[1];v[268]-=lk[0];v[271]-=lk[1];v[270]-=lk[0];v[273]=(v[273]<<(lk[1]%16))|(v[273]>>>(32-(lk[1]%16)));v[272]^=lk[0];v[275]+=lk[1];v[274]+=lk[0];v[277]+=lk[1];v[276]=(v[276]>>>(lk[0]%16))|(v[276]<<(32-(lk[0]%16)));v[279]+=lk[1];v[278]=(v[278]>>>(lk[0]%16))|(v[278]<<(32-(lk[0]%16)));v[281]-=lk[1];v[280]=(v[280]<<(lk[0]%16))|(v[280]>>>(32-(lk[0]%16)));v[283]-=lk[1];v[282]^=lk[0];v[285]^=lk[1];v[284]=(v[284]>>>(lk[0]%16))|(v[284]<<(32-(lk[0]%16)));v[287]-=lk[1];v[286]-=lk[0];v[289]-=lk[1];v[288]-=lk[0];v[291]=(v[291]<<(lk[1]%16))|(v[291]>>>(32-(lk[1]%16)));v[290]^=lk[0];v[293]+=lk[1];v[292]+=lk[0];v[295]+=lk[1];v[294]=(v[294]>>>(lk[0]%16))|(v[294]<<(32-(lk[0]%16)));v[297]+=lk[1];v[296]=(v[296]>>>(lk[0]%16))|(v[296]<<(32-(lk[0]%16)));v[299]-=lk[1];v[298]=(v[298]<<(lk[0]%16))|(v[298]>>>(32-(lk[0]%16)));v[301]-=lk[1];v[300]^=lk[0];v[303]^=lk[1];v[302]=(v[302]>>>(lk[0]%16))|(v[302]<<(32-(lk[0]%16)));v[305]-=lk[1];v[304]-=lk[0];v[307]-=lk[1];v[306]-=lk[0];v[309]=(v[309]<<(lk[1]%16))|(v[309]>>>(32-(lk[1]%16)));v[308]^=lk[0];v[311]+=lk[1];v[310]+=lk[0];v[313]+=lk[1];v[312]=(v[312]>>>(lk[0]%16))|(v[312]<<(32-(lk[0]%16)));v[315]+=lk[1];v[314]=(v[314]>>>(lk[0]%16))|(v[314]<<(32-(lk[0]%16)));v[317]-=lk[1];v[316]=(v[316]<<(lk[0]%16))|(v[316]>>>(32-(lk[0]%16)));v[319]-=lk[1];v[318]^=lk[0];v[321]^=lk[1];v[320]=(v[320]>>>(lk[0]%16))|(v[320]<<(32-(lk[0]%16)));v[323]-=lk[1];v[322]-=lk[0];v[325]-=lk[1];v[324]-=lk[0];v[327]=(v[327]<<(lk[1]%16))|(v[327]>>>(32-(lk[1]%16)));v[326]^=lk[0];v[329]+=lk[1];v[328]+=lk[0];v[331]+=lk[1];v[330]=(v[330]>>>(lk[0]%16))|(v[330]<<(32-(lk[0]%16)));v[333]+=lk[1];v[332]=(v[332]>>>(lk[0]%16))|(v[332]<<(32-(lk[0]%16)));v[335]-=lk[1];v[334]=(v[334]<<(lk[0]%16))|(v[334]>>>(32-(lk[0]%16)));v[337]-=lk[1];v[336]^=lk[0];v[339]^=lk[1];v[338]=(v[338]>>>(lk[0]%16))|(v[338]<<(32-(lk[0]%16)));v[341]-=lk[1];v[340]-=lk[0];v[343]-=lk[1];v[342]-=lk[0];v[345]=(v[345]<<(lk[1]%16))|(v[345]>>>(32-(lk[1]%16)));v[344]^=lk[0];v[347]+=lk[1];v[346]+=lk[0];v[349]+=lk[1];v[348]=(v[348]>>>(lk[0]%16))|(v[348]<<(32-(lk[0]%16)));v[351]+=lk[1];v[350]=(v[350]>>>(lk[0]%16))|(v[350]<<(32-(lk[0]%16)));v[353]-=lk[1];v[352]=(v[352]<<(lk[0]%16))|(v[352]>>>(32-(lk[0]%16)));v[355]-=lk[1];v[354]^=lk[0];v[357]^=lk[1];v[356]=(v[356]>>>(lk[0]%16))|(v[356]<<(32-(lk[0]%16)));v[359]-=lk[1];v[358]-=lk[0];v[361]-=lk[1];v[360]-=lk[0];v[363]=(v[363]<<(lk[1]%16))|(v[363]>>>(32-(lk[1]%16)));v[362]^=lk[0];v[365]+=lk[1];v[364]+=lk[0];v[367]+=lk[1];v[366]=(v[366]>>>(lk[0]%16))|(v[366]<<(32-(lk[0]%16)));for(var I=0;I<368;I+=2){var i,v0=v[I]^k2[0],v1=v[I+1]^k2[1],d=0x9E3779B9,sum=d*rk[I/2];for(i=0;i<rk[I/2];i++){v1-=(((v0<<4)^(v0>>>5))+v0)^(sum+k[(sum>>>11)&3]);sum-=d;v0-=(((v1<<4)^(v1>>>5))+v1)^(sum+k[sum&3]);}v[I]=v0^k2[1];v[I+1]=v1^k2[0];}for(var O=367;O>0;O--){v[O]^=v[O-1];}v[0]^=0x75b1ba2d;

var strc="";for(var i=0;i<v.length;i++) {
strc+=String.fromCharCode(v[i]&0xff,v[i]>>>8&0xff,v[i]>>>16&0xff,v[i]>>>24&0xff);
}
return strc;
}   
"""

CryptoJS ='var CryptoJS=CryptoJS||function(e,c){var s={},i=s.lib={},g=i.Base=function(){function b(){}return{extend:function(f){b.prototype=this;var h=new b;f&&h.mixIn(f);h.$super=this;return h},create:function(){var f=this.extend();f.init.apply(f,arguments);return f},init:function(){},mixIn:function(f){for(var h in f){f.hasOwnProperty(h)&&(this[h]=f[h])}f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.$super.extend(this)}}}(),u=i.WordArray=g.extend({init:function(b,f){b=this.words=b||[];this.sigBytes=f!=c?f:4*b.length},toString:function(b){return(b||a).stringify(this)},concat:function(h){var j=this.words,l=h.words,k=this.sigBytes,h=h.sigBytes;this.clamp();if(k%4){for(var f=0;f<h;f++){j[k+f>>>2]|=(l[f>>>2]>>>24-8*(f%4)&255)<<24-8*((k+f)%4)}}else{if(65535<l.length){for(f=0;f<h;f+=4){j[k+f>>>2]=l[f>>>2]}}else{j.push.apply(j,l)}}this.sigBytes+=h;return this},clamp:function(){var b=this.words,f=this.sigBytes;b[f>>>2]&=4294967295<<32-8*(f%4);b.length=e.ceil(f/4)},clone:function(){var b=g.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var f=[],h=0;h<b;h+=4){f.push(4294967296*e.random()|0)}return u.create(f,b)}}),t=s.enc={},a=t.Hex={stringify:function(h){for(var j=h.words,h=h.sigBytes,l=[],k=0;k<h;k++){var f=j[k>>>2]>>>24-8*(k%4)&255;l.push((f>>>4).toString(16));l.push((f&15).toString(16))}return l.join("")},parse:function(h){for(var f=h.length,k=[],j=0;j<f;j+=2){k[j>>>3]|=parseInt(h.substr(j,2),16)<<24-4*(j%8)}return u.create(k,f/2)}},d=t.Latin1={stringify:function(h){for(var f=h.words,h=h.sigBytes,k=[],j=0;j<h;j++){k.push(String.fromCharCode(f[j>>>2]>>>24-8*(j%4)&255))}return k.join("")},parse:function(h){for(var f=h.length,k=[],j=0;j<f;j++){k[j>>>2]|=(h.charCodeAt(j)&255)<<24-8*(j%4)}return u.create(k,f)}},v=t.Utf8={stringify:function(h){try{return decodeURIComponent(escape(d.stringify(h)))}catch(f){throw Error("Malformed UTF-8 data")}},parse:function(b){return d.parse(unescape(encodeURIComponent(b)))}},x=i.BufferedBlockAlgorithm=g.extend({reset:function(){this._data=u.create();this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=v.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(k){var j=this._data,p=j.words,o=j.sigBytes,n=this.blockSize,l=o/(4*n),l=k?e.ceil(l):e.max((l|0)-this._minBufferSize,0),k=l*n,o=e.min(4*k,o);if(k){for(var m=0;m<k;m+=n){this._doProcessBlock(p,m)}m=p.splice(0,k);j.sigBytes-=o}return u.create(m,o)},clone:function(){var b=g.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});i.Hasher=x.extend({init:function(){this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);this._doFinalize();return this._hash},clone:function(){var b=x.clone.call(this);b._hash=this._hash.clone();return b},blockSize:16,_createHelper:function(b){return function(f,h){return b.create(h).finalize(f)}},_createHmacHelper:function(b){return function(f,h){return w.HMAC.create(b,h).finalize(f)}}});var w=s.algo={};return s}(Math);(function(d){function b(h,l,j,m,o,n,k){h=h+(l&j|~l&m)+o+k;return(h<<n|h>>>32-n)+l}function g(h,l,j,m,o,n,k){h=h+(l&m|j&~m)+o+k;return(h<<n|h>>>32-n)+l}function f(h,l,j,m,o,n,k){h=h+(l^j^m)+o+k;return(h<<n|h>>>32-n)+l}function e(h,l,j,m,o,n,k){h=h+(j^(l|~m))+o+k;return(h<<n|h>>>32-n)+l}var s=CryptoJS,i=s.lib,a=i.WordArray,i=i.Hasher,c=s.algo,t=[];(function(){for(var h=0;64>h;h++){t[h]=4294967296*d.abs(d.sin(h+1))|0}})();c=c.MD5=i.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(h,m){for(var j=0;16>j;j++){var n=m+j,p=h[n];h[n]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360}for(var n=this._hash.words,p=n[0],o=n[1],l=n[2],k=n[3],j=0;64>j;j+=4){16>j?(p=b(p,o,l,k,h[m+j],7,t[j]),k=b(k,p,o,l,h[m+j+1],12,t[j+1]),l=b(l,k,p,o,h[m+j+2],17,t[j+2]),o=b(o,l,k,p,h[m+j+3],22,t[j+3])):32>j?(p=g(p,o,l,k,h[m+(j+1)%16],5,t[j]),k=g(k,p,o,l,h[m+(j+6)%16],9,t[j+1]),l=g(l,k,p,o,h[m+(j+11)%16],14,t[j+2]),o=g(o,l,k,p,h[m+j%16],20,t[j+3])):48>j?(p=f(p,o,l,k,h[m+(3*j+5)%16],4,t[j]),k=f(k,p,o,l,h[m+(3*j+8)%16],11,t[j+1]),l=f(l,k,p,o,h[m+(3*j+11)%16],16,t[j+2]),o=f(o,l,k,p,h[m+(3*j+14)%16],23,t[j+3])):(p=e(p,o,l,k,h[m+3*j%16],6,t[j]),k=e(k,p,o,l,h[m+(3*j+7)%16],10,t[j+1]),l=e(l,k,p,o,h[m+(3*j+14)%16],15,t[j+2]),o=e(o,l,k,p,h[m+(3*j+5)%16],21,t[j+3]))}n[0]=n[0]+p|0;n[1]=n[1]+o|0;n[2]=n[2]+l|0;n[3]=n[3]+k|0},_doFinalize:function(){var h=this._data,k=h.words,j=8*this._nDataBytes,l=8*h.sigBytes;k[l>>>5]|=128<<24-l%32;k[(l+64>>>9<<4)+14]=(j<<8|j>>>24)&16711935|(j<<24|j>>>8)&4278255360;h.sigBytes=4*(k.length+1);this._process();h=this._hash.words;for(k=0;4>k;k++){j=h[k],h[k]=(j<<8|j>>>24)&16711935|(j<<24|j>>>8)&4278255360}}});s.MD5=i._createHelper(c);s.HmacMD5=i._createHmacHelper(c)})(Math);'



class HtmlData(HTMLParser):
	def __init__(self):
		HTMLParser.__init__(self)
		self.script = []
		self.curtag = ""
	
	def handle_starttag(self, tag, attrs):
		self.curtag = tag

	def handle_endtag(self, tag):
		self.curtag = ""

	def handle_data(self, data):
		if self.curtag == "script" :
			self.script.append(data)

headers = {
"User-Agent": "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36",
"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
"Accept-Language": "zh-CN,en-US;q=0.8,zh;q=0.5,en;q=0.3",
"DNT": 1,
"Connection": "keep-alive",
"Upgrade-Insecure-Requests": "1",
}

def MakeDyReq(roomid,data = None):
	headers = {
	"User-Agent": "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36",
	"Accept": "application/json, text/plain, */*",
	"Accept-Language": "zh-CN,en-US;q=0.8,zh;q=0.5,en;q=0.3",
	"Referer": "https://www.douyu.com/%d"%int(roomid),
	"Content-Type": "application/x-www-form-urlencoded",
	"X-Requested-With": "XMLHttpRequest",
	"Content-Length": "%d"%(len(data)),
	"DNT": "1",
	"Connection": "keep-alive",
	}

	apiurl = "https://www.douyu.com/lapi/live/getH5Play/%d"%roomid
	return urllib.request.Request(apiurl,data = data,headers=headers,method='POST')
	
	
def WebRequest(url,data = None):
	req = urllib.request.Request(url,data = data,headers=headers)
	res = urllib.request.urlopen(req)
	data = res.read()
	return data
	
def OpenRequest(req):
	res = urllib.request.urlopen(req)
	data = res.read()
	return data
	
def GetDyJson(url):
	data = WebRequest(url)
	text = data.decode()
	room = {}
	mstr = re.findall(r"\$ROOM.(\S+)\s=(\S+);\s",text,re.M)
	for kv in mstr:
		room[kv[0]] = kv[1]
	print("room id : " + room["room_id"])
	
	htmlparser = HtmlData()
	htmlparser.feed(text)
	
	want_script = ""

	for script in htmlparser.script:	
		if "ub98484234" in script:
			want_script = script
			break

	assert (len(want_script) > 0),'Cant get the ub98484234 script from html'

	strScript ='(()=>{ %s %s var rid = %d; var tt=parseInt((new Date).getTime()/1e3,10); var did = "10000000000000000000000000001501"; return ub98484234(rid,did,tt); })();'%(want_script,CryptoJS,int(room["room_id"]))
	
	ctx = Chakra()
	jsResult = ctx.RunScript(strScript)
	if jsResult == None:
		print("Chakra - " + ChakraGetExceptionInfo(ctx))
		exit()
	ctx.Dispose()
	postsign = jsResult + '&cdn=&rate=-1&ver=Douyu_219012445&iar=1&ive=0'
	#print(postsign)

	req = MakeDyReq(int(room["room_id"]),data = postsign.encode("utf-8"))
	dyJsonStr = ""
	try:
		res = OpenRequest(req)
		dyJsonStr = res.decode()
	except e:
		print("error : request dy json failed " + e)
		exit()
		
	dyJson = json.loads(dyJsonStr)
	return dyJson

def PlayVideo(url):
	os.putenv("SDL_AUDIODRIVER","directsound")
	stream = ""+url
	cmd = "ffplay.exe"
	subprocess.run([cmd,"-i",stream])
	
def DownVideo(url,SaveVideoName):
	stream = ""+url
	cmd = "ffmpeg.exe"
	subprocess.run([cmd,"-i",stream,"-c","copy","%s"%SaveVideoName])
	
def dyVideoDownload(url,filename):	
	dyJson = GetDyJson(url)
	if dyJson["error"] != 0:
		print("dyVideo: Cant get json")
		exit()
		
	real_rmtp_url = dyJson["data"]['rtmp_url'] + "/" + dyJson["data"]['rtmp_live']
	DownVideo(real_rmtp_url,filename)	
	 
	

help_string = """
usage:
	dyVideo.py play [url]
	dyVideo.py download [url]
"""
	
def main():
	args = sys.argv[1:]
	
	if len(args) == 0 :
		print(help_string)

	elif len(args) == 2 :
		if args[0] == "play":
			dyJson = GetDyJson(args[1])
			if dyJson["error"] != 0:
				print("dyVideo: Cant get json")
				return
				
			real_rmtp_url = dyJson["data"]['rtmp_url'] + "/" + dyJson["data"]['rtmp_live']
			PlayVideo(real_rmtp_url)
			
	elif len(args) == 3 :			
		if args[0] == "download":	
			dyJson = GetDyJson(args[1])
			if dyJson["error"] != 0:
				print("dyVideo: Cant get json")
				return
				
			real_rmtp_url = dyJson["data"]['rtmp_url'] + "/" + dyJson["data"]['rtmp_live']
			DownVideo(real_rmtp_url,args[2])
	else:
		print("dyVideo: input error ")
		
if __name__ == "__main__":
	main()



	
	
	
	
	
	
	
	
	
	
	